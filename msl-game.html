<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MSL Study Lab & Games ‚Äì SMCM MSL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="logo-1.png" />

  <!-- Page-specific layout tweaks -->
  <style>
    body.game-page {
      background: radial-gradient(circle at top, #111827, #020617);
      color: #f9fafb;
    }

    .game-page .section {
      padding-top: 3rem;
      padding-bottom: 3rem;
    }

    .game-page h1,
    .game-page h2,
    .game-page h3 {
      color: #f9fafb;
    }

    .game-layout {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    @media (min-width: 900px) {
      .game-layout {
        flex-direction: row;
        align-items: flex-start;
      }
      .game-layout-main {
        flex: 3;
      }
      .game-layout-side {
        flex: 2;
      }
    }

    .game-column {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .game-card-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    .game-card-title span.label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
    }

    .game-card-title span.label.study {
      color: #4ade80;
    }
    .game-card-title span.label.game {
      color: #60a5fa;
    }

    .game-page .card.plain-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.8);
    }

    .game-page .small,
    .game-page .section-body,
    .game-page p {
      color: #e5e7eb;
    }

    /* Canvas containers */
    .canvas-shell {
      background: #020617;
      border-radius: 0.75rem;
      padding: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      text-align: center;
    }
    .canvas-shell canvas {
      background: #020617;
      display: block;
      margin: 0 auto;
      max-width: 100%;
      border-radius: 0.5rem;
    }

    .controls-text {
      font-size: 0.8rem;
      opacity: 0.9;
      margin-top: 0.35rem;
    }

    /* Quiz styles */
    #quiz-container {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    #quiz-question {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    #quiz-options button {
      display: block;
      width: 100%;
      text-align: left;
      border-radius: 0.5rem;
      padding: 0.5rem 0.75rem;
      margin-bottom: 0.4rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      cursor: pointer;
      font-size: 0.9rem;
    }
    #quiz-options button:hover {
      background: rgba(37, 99, 235, 0.2);
    }
    #quiz-feedback {
      font-size: 0.85rem;
      min-height: 1.2em;
    }

    /* Hangman */
    #hangman-word {
      font-size: 1.25rem;
      letter-spacing: 0.25em;
      text-align: center;
      margin-bottom: 0.5rem;
    }
    #hangman-letters button {
      margin: 0.1rem;
      padding: 0.25rem 0.4rem;
      border-radius: 0.35rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 0.75rem;
      cursor: pointer;
    }
    #hangman-letters button:disabled {
      opacity: 0.4;
      cursor: default;
    }
    #hangman-status {
      font-size: 0.85rem;
      margin-top: 0.4rem;
      text-align: center;
      min-height: 1.2em;
    }

    /* Companion dock (corner widget) */
    #companionDock {
      position: fixed;
      right: 1rem;
      bottom: 1rem;
      z-index: 40;
      font-size: 0.75rem;
      color: #e5e7eb;
    }
    #companionToggle {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: radial-gradient(circle at 30% 20%, #facc15, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.75);
    }
    #companionPanel {
      position: absolute;
      right: 60px;
      bottom: 0;
      width: 230px;
      padding: 0.75rem;
      border-radius: 0.75rem;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.9);
      display: none;
    }
    #companionPanel.open {
      display: block;
    }

    .companion-bars {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
    }
    .bar {
      min-width: 90px;
    }
    .bar-label {
      font-size: 0.7rem;
      opacity: 0.8;
    }
    .bar-track {
      height: 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
      margin-top: 0.1rem;
    }
    .bar-fill {
      height: 100%;
      border-radius: inherit;
      width: 100%;
      transition: width 0.3s ease-out;
    }
    .bar-fill.energy {
      background: #22c55e;
    }
    .bar-fill.mood {
      background: #facc15;
    }
    .bar-fill.focus {
      background: #38bdf8;
    }

    .companion-actions {
      display: flex;
      gap: 0.35rem;
      flex-wrap: wrap;
      justify-content: flex-end;
      margin-top: 0.35rem;
    }
    .companion-actions button {
      border-radius: 999px;
      padding: 0.2rem 0.6rem;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 0.7rem;
      cursor: pointer;
    }
    .companion-actions button:hover {
      background: rgba(37, 99, 235, 0.4);
    }

    .pet-playground {
      position: relative;
      height: 280px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      border-radius: 0.9rem;
      overflow: hidden;
      background: radial-gradient(circle at 20% 20%, rgba(96, 165, 250, 0.1), rgba(37, 99, 235, 0.05)),
        linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
    }

    .pet-avatar {
      position: absolute;
      width: 108px;
      height: 108px;
      object-fit: contain;
      left: 50%;
      top: 65%;
      transform: translate(-50%, -50%);
      transition: filter 0.2s ease, transform 0.2s ease;
      pointer-events: none;
    }

    .pet-treat {
      position: absolute;
      width: 72px;
      height: 72px;
      object-fit: cover;
      border-radius: 0.65rem;
      border: 2px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.55);
      transform: translate(-50%, -50%);
      transition: opacity 0.25s ease;
      opacity: 0;
      pointer-events: none;
    }

    .pet-treat.active {
      opacity: 1;
    }

    .pet-pop {
      position: absolute;
      font-size: 0.9rem;
      color: #facc15;
      text-shadow: 0 3px 10px rgba(0, 0, 0, 0.7);
      transform: translate(-50%, -50%);
      opacity: 0;
      pointer-events: none;
    }

    .pet-pop.show {
      animation: popRise 0.9s ease-out;
    }

    @keyframes popRise {
      0% {
        opacity: 0;
        transform: translate(-50%, -10%);
      }
      30% {
        opacity: 1;
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -60%);
      }
    }

    @media (max-width: 640px) {
      .pet-playground {
        height: 230px;
      }
      .pet-avatar {
        width: 96px;
        height: 96px;
      }
    }

    .pet-controls {
      display: grid;
      gap: 0.35rem;
      margin-top: 0.35rem;
    }

    .pet-controls .btn {
      width: 100%;
    }

    .pet-choices,
    .pet-actions {
      display: grid;
      gap: 0.35rem;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    }

    .reaction-shell {
      border: 1px dashed rgba(148, 163, 184, 0.5);
      border-radius: 0.75rem;
      padding: 0.75rem;
      background: rgba(15, 23, 42, 0.45);
    }

    .reaction-controls {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin: 0.5rem 0;
    }

    /* YouTube embed ratio */
    .video-shell {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }
    .video-shell iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }
  </style>
</head>

<body class="game-page">
  <header class="site-header">
    <div class="inner">
      <a href="index.html#hero" class="brand">
        <span class="brand-mark brand-mark-logo">
          <img src="logo-1.png" alt="SMCM MSL logo" />
        </span>
        <span class="brand-text">
          <span class="brand-title">Maryland Student Legislature</span>
          <span class="brand-sub">St. Mary‚Äôs College of Maryland Chapter</span>
        </span>
      </a>
      <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">‚ò∞</button>
      <nav class="nav" id="mainNav">
        <a class="nav-link" href="index.html#hero">Home</a>
        <a class="nav-link" href="index.html#maryland">About MSL</a>
        <a class="nav-link" href="index.html#chapter">Our Chapter</a>
        <a class="nav-link" href="index.html#journey">Your Journey</a>
        <a class="nav-link" href="index.html#documents">Documents</a>
        <a class="nav-link" href="executive-board.html">Exec Board</a>
        <a class="nav-link" href="resources.html">Resources</a>
        <a class="nav-link" href="bulletin.html">Bulletin</a>
        <a class="nav-link nav-link--active" aria-current="page" href="msl-game.html">Games</a>
        <a class="nav-link" href="index.html#gallery">Gallery</a>
        <a class="nav-link" href="index.html#contact">Join Us</a>
        <a class="nav-link" href="neophytus.html">Neophytus</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- HEADER -->
    <section class="section">
      <div class="inner">
        <div class="section-header center">
          <p class="eyebrow">Practice, Play, Repeat</p>
          <h1>MSL Study Lab & Mini-Games</h1>
          <p class="section-body">
            Use this space to quiz yourself on legislative basics, watch a short explainer on how bills
            become law, and then unwind with some low-stakes mini-games and a floating ‚Äúfield companion.‚Äù
            Desktop is recommended for the games (keyboard controls), but the video and quiz work on mobile too.
          </p>
        </div>

        <div class="game-layout">
          <!-- LEFT: STUDY COLUMN -->
          <div class="game-layout-main game-column">
            <!-- Quiz -->
            <article class="card plain-card">
              <div class="game-card-title">
                <h2>MSL Quick Quiz</h2>
                <span class="label study">Study</span>
              </div>
              <p class="small">
                Short questions based on things you‚Äôll see in MSL: committees, bills, chambers, and procedure.
                Great to run through before a meeting or session.
              </p>
              <div id="quiz-container">
                <div id="quiz-question"></div>
                <div id="quiz-options"></div>
                <div id="quiz-feedback" class="small"></div>
                <button id="quiz-next" class="btn btn-primary small" style="margin-top:0.5rem;">
                  Next Question
                </button>
                <p id="quiz-score" class="small" style="margin-top:0.5rem;"></p>
              </div>
            </article>

            <!-- CrashCourse video -->
            <article class="card plain-card">
              <div class="game-card-title">
                <h2>How a Bill Becomes Law (Crash Course)</h2>
                <span class="label study">Watch</span>
              </div>
              <p class="small">
                A quick visual run-through of committee, floor, and conference stages. Different level than MSL,
                same core logic of how ideas move through a legislature.
              </p>
              <div class="video-shell">
                <!-- Crash Course Government & Politics: How a Bill Becomes a Law -->
                <iframe
                  src="https://www.youtube.com/embed/66f4-NKEYz4"
                  title="How a Bill Becomes a Law ‚Äì Crash Course Government and Politics"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen
                ></iframe>
              </div>
            </article>
          </div>

          <!-- RIGHT: GAMES COLUMN -->
          <div class="game-layout-side game-column">
            <!-- Snake -->
            <article class="card plain-card">
              <div class="game-card-title">
                <h2>Chamber Snake</h2>
                <span class="label game">Game</span>
              </div>
              <p class="small">
                Classic snake-style game. Collect ‚Äúbills‚Äù (squares) and avoid running into yourself.
                <strong>Controls:</strong> W, A, S, D keys on desktop. On mobile, this one is better viewed than played.
              </p>
              <p class="small" style="opacity:0.8;">Difficulty: Steady pace‚Äîgood for zoning out between study bursts.</p>
              <div class="canvas-shell">
                <canvas id="snakeCanvas" width="260" height="260"></canvas>
              </div>
              <p class="controls-text">
                Tip: Try to survive long enough to pass 10 ‚Äúbills‚Äù in one run.
              </p>
            </article>

            <!-- Runner -->
            <article class="card plain-card">
              <div class="game-card-title">
                <h2>Floor Runner</h2>
                <span class="label game">Game</span>
              </div>
              <p class="small">
                Dodge procedural triangles, avoid gaps, and hit ‚Äúboost blocks‚Äù to pick up speed.
                <strong>Controls:</strong> Spacebar or tap/click inside the game box to jump.
              </p>
              <p class="small" style="opacity:0.8;">Energy: Fast reflexes‚Äîbest when you want a quick adrenaline spike.</p>
              <div class="canvas-shell">
                <canvas id="runnerCanvas" width="260" height="160"></canvas>
              </div>
              <p class="controls-text">
                Score = seconds survived. Make it to 5 minutes on a run to unlock the secret lab.
              </p>
              <p id="runner-best" class="small" style="margin-top:0.35rem;"></p>
              <div id="runner-leaderboard" class="small" style="margin-top:0.25rem;"></div>
            </article>

            <!-- Hangman -->
            <article class="card plain-card">
              <div class="game-card-title">
                <h2>Legislative Hangman</h2>
                <span class="label game">Game</span>
              </div>
              <p class="small">
                Guess MSL-related words before your attempts run out. All terms are drawn from things you‚Äôll hear
                in meetings, bylaws, or statewide sessions.
              </p>
              <p class="small" style="opacity:0.8;">Vibe: Low-stress letters game for when you need a breather.</p>
              <div id="hangman-word">_ _ _ _</div>
              <div id="hangman-letters"></div>
              <div id="hangman-status" class="small"></div>
              <button id="hangman-reset" class="btn btn-primary small" style="margin-top:0.5rem;">
                New Word
              </button>
            </article>

            <!-- Reaction time game -->
            <article class="card plain-card">
              <div class="game-card-title">
                <h2>Gavel Reflex Drill</h2>
                <span class="label game">Game</span>
              </div>
              <p class="small">
                The presiding officer calls a vote‚Äîreact as soon as you see ‚ÄúGO‚Äù to log a lightning-fast time.
                Click or press the space bar when the prompt appears.
              </p>
              <p class="small" style="opacity:0.8;">Mode: Quick-fire reflex test with honest feedback.</p>
              <div class="reaction-shell">
                <p id="reactionStatus" class="small">Press ‚ÄúStart round‚Äù to begin.</p>
                <div class="reaction-controls">
                  <button id="reactionStart" class="btn btn-primary small">Start round</button>
                  <button id="reactionTap" class="btn btn-ghost small" disabled>Tap when you see ‚ÄúGO‚Äù</button>
                </div>
                <p id="reactionResult" class="small"></p>
                <p id="reactionBest" class="small" style="opacity:0.75;"></p>
              </div>
            </article>

            <!-- Moving pet widget -->
            <article class="card plain-card">
              <div class="game-card-title">
                <h2>Roaming Study Buddy</h2>
                <span class="label game">Widget</span>
              </div>
              <p class="small">
                Pick a pet and guide it around the board with your mouse or a tap. Drop a treat to send it
                chasing across the space, or recentre it before the next round of games.
              </p>
              <p class="small" style="opacity:0.8;">Mood: Low-stress clicker with collectible treats.</p>
              <div id="petPlayground" class="pet-playground" aria-label="Interactive pet playground">
                <img id="petAvatar" class="pet-avatar" src="pet-dog.gif" alt="Animated study buddy" />
              </div>
              <p id="petStatus" class="small" style="margin-top:0.35rem; opacity:0.85;">Move your cursor inside the box to guide the dog.</p>
              <div class="pet-controls">
                <div class="pet-choices">
                  <button class="btn btn-ghost small" data-pet-select="dog">Dog</button>
                  <button class="btn btn-ghost small" data-pet-select="cat">Cat</button>
                  <button class="btn btn-ghost small" data-pet-select="koala">Koala</button>
                </div>
                <div class="pet-actions">
                  <button class="btn btn-primary small" id="petTreat">Drop a treat</button>
                  <button class="btn btn-ghost small" id="petRoam">Calm &amp; center</button>
                </div>
              </div>
            </article>
          </div>
        </div>
      </div>
    </section>

    <!-- SECRET UNLOCK SECTION -->
    <section class="section" id="secretSection" style="display:none;">
      <div class="inner">
        <article class="card plain-card">
          <h2>Secret Page Unlocked</h2>
          <p class="small">
            You (or someone on this device) survived a full 5 minutes in Floor Runner. That earns access
            to a hidden experiments page for future mini-games.
          </p>
          <p class="small">
            <a href="msl-secret.html" class="btn btn-primary small">Open Secret Lab (Coming Soon)</a>
          </p>
        </article>
      </div>
    </section>

    <!-- COMPANION SECTION (TEXT ONLY) -->
    <section class="section bg-alt">
      <div class="inner">
        <div class="section-header">
          <p class="eyebrow">Field Companion</p>
          <h2>Your Little MSL Study Buddy</h2>
          <p class="section-body">
            Look for the little buddy in the bottom-right corner of this page. Tap or click it to open
            quick controls, swap between dog / cat / koala, and keep an eye on its mood, energy, and focus
            while you work through the games and quiz.
          </p>
        </div>
      </div>
    </section>
  </main>

  <!-- Floating companion widget -->
  <div id="companionDock">
    <button id="companionToggle" aria-label="Toggle companion panel">üê∂</button>
    <div id="companionPanel">
      <p style="margin-bottom:0.35rem;">Field Companion</p>
      <div class="companion-bars">
        <div class="bar">
          <div class="bar-label">Energy</div>
          <div class="bar-track">
            <div id="barEnergy" class="bar-fill energy"></div>
          </div>
        </div>
        <div class="bar">
          <div class="bar-label">Mood</div>
          <div class="bar-track">
            <div id="barMood" class="bar-fill mood"></div>
          </div>
        </div>
        <div class="bar">
          <div class="bar-label">Focus</div>
          <div class="bar-track">
            <div id="barFocus" class="bar-fill focus"></div>
          </div>
        </div>
      </div>
      <div class="companion-actions">
        <button data-pet="dog">Dog</button>
        <button data-pet="cat">Cat</button>
        <button data-pet="koala">Koala</button>
        <button data-action="feed">Feed</button>
        <button data-action="play">Play</button>
        <button data-action="study">Study</button>
      </div>
      <p class="small" style="margin-top:0.4rem; opacity:0.8;">
        Bars slowly drift down over time. Use actions to top them back up.
      </p>
    </div>
  </div>

  <footer class="site-footer">
    <div class="inner footer-inner">
      <p>¬© <span id="year"></span> Maryland Student Legislature ‚Äì St. Mary‚Äôs College of Maryland Chapter.</p>
      <p class="small">
        Student-led, nonpartisan, and rooted in Maryland‚Äôs civic life. This site is maintained by the SMCM
        Maryland Student Legislature Chapter and is not an official publication of St. Mary‚Äôs College of
        Maryland or the State of Maryland.
      </p>
    </div>
  </footer>

  <script src="script.js"></script>

  <!-- Page-specific JS: all guarded so errors don't break the page -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      /* ---------- SECRET UNLOCK ---------- */
      const secretSection = document.getElementById("secretSection");
      function unlockSecret() {
        if (!secretSection) return;
        secretSection.style.display = "block";
        try {
          localStorage.setItem("mslSecretUnlocked", "true");
        } catch (e) {}
      }
      (function restoreSecret() {
        try {
          if (localStorage.getItem("mslSecretUnlocked") === "true" && secretSection) {
            secretSection.style.display = "block";
          }
        } catch (e) {}
      })();

      /* ---------- QUIZ ---------- */
      (function () {
        const questionEl = document.getElementById("quiz-question");
        const optionsEl = document.getElementById("quiz-options");
        const feedbackEl = document.getElementById("quiz-feedback");
        const nextBtn = document.getElementById("quiz-next");
        const scoreEl = document.getElementById("quiz-score");

        if (!questionEl || !optionsEl || !feedbackEl || !nextBtn || !scoreEl) return;

        const quiz = [
          {
            q: "In MSL, where does most detailed work on a bill happen first?",
            options: [
              "On the floor during final vote",
              "In committee hearings and markups",
              "In the governor‚Äôs office",
              "On social media"
            ],
            correct: 1
          },
          {
            q: "Which phrase best matches what a ‚Äúsponsor‚Äù does?",
            options: [
              "Writes and introduces the bill",
              "Keeps time during speeches",
              "Runs the statewide organization",
              "Counts votes after the session"
            ],
            correct: 0
          },
          {
            q: "A motion to ‚Äòtable‚Äô a bill usually means:",
            options: [
              "The bill passes immediately",
              "Debate continues with no speeches",
              "Consideration is paused or set aside",
              "The bill must be rewritten from scratch"
            ],
            correct: 2
          },
          {
            q: "What‚Äôs the main role of a committee chair?",
            options: [
              "To write every bill",
              "To enforce rules and manage discussion",
              "To record every vote by hand",
              "To campaign for statewide office"
            ],
            correct: 1
          },
          {
            q: "Why does MSL use parliamentary procedure?",
            options: [
              "To confuse new members",
              "To keep debate fair, orderly, and consistent",
              "Because it‚Äôs required by Maryland law",
              "So only officers can speak"
            ],
            correct: 1
          }
        ];

        let index = 0;
        let score = 0;
        let answered = false;

        function renderQuestion() {
          const current = quiz[index];
          answered = false;
          questionEl.textContent = current.q;
          feedbackEl.textContent = "";
          optionsEl.innerHTML = "";
          current.options.forEach((opt, i) => {
            const btn = document.createElement("button");
            btn.textContent = opt;
            btn.addEventListener("click", () => handleAnswer(i));
            optionsEl.appendChild(btn);
          });
          scoreEl.textContent = `Question ${index + 1} of ${quiz.length} ¬∑ Score: ${score}`;
        }

        function handleAnswer(choice) {
          if (answered) return;
          answered = true;
          const current = quiz[index];
          if (choice === current.correct) {
            score++;
            feedbackEl.textContent = "Correct ‚Äì you‚Äôd survive in committee.";
            feedbackEl.style.color = "#4ade80";
          } else {
            feedbackEl.textContent = "Not quite ‚Äì check how we do it in MSL.";
            feedbackEl.style.color = "#f97373";
          }
          scoreEl.textContent = `Question ${index + 1} of ${quiz.length} ¬∑ Score: ${score}`;
        }

        nextBtn.addEventListener("click", () => {
          index++;
          if (index >= quiz.length) {
            feedbackEl.textContent =
              score === quiz.length
                ? "Perfect run. Secret reward: you‚Äôre now unofficially ‚Äòfloor ready‚Äô."
                : "Nice work. Run it again later and see if you can get them all.";
            feedbackEl.style.color = "#facc15";
            index = 0;
            score = 0;
          }
          renderQuestion();
        });

        renderQuestion();
      })();

      /* ---------- SNAKE GAME (desktop-focused) ---------- */
      (function () {
        const canvas = document.getElementById("snakeCanvas");
        if (!canvas) return;
        const ctx = canvas.getContext("2d");

        const cols = 13;
        const rows = 13;
        const cellSize = Math.floor(canvas.width / cols);

        let snake, dir, food, alive;

        function resetSnake() {
          snake = [{ x: 6, y: 6 }];
          dir = { x: 0, y: -1 }; // up
          spawnFood();
          alive = true;
        }

        function spawnFood() {
          food = {
            x: Math.floor(Math.random() * cols),
            y: Math.floor(Math.random() * rows)
          };
          if (snake.some(seg => seg.x === food.x && seg.y === food.y)) {
            spawnFood();
          }
        }

        function step() {
          if (!alive) return;
          const head = snake[0];
          const next = { x: head.x + dir.x, y: head.y + dir.y };

          if (next.x < 0 || next.x >= cols || next.y < 0 || next.y >= rows) {
            alive = false;
            return;
          }

          if (snake.some(seg => seg.x === next.x && seg.y === next.y)) {
            alive = false;
            return;
          }

          snake.unshift(next);

          if (next.x === food.x && next.y === food.y) {
            spawnFood();
          } else {
            snake.pop();
          }
        }

        function draw() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "#020617";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // food
          ctx.fillStyle = "#f97316";
          ctx.fillRect(
            food.x * cellSize + 2,
            food.y * cellSize + 2,
            cellSize - 4,
            cellSize - 4
          );

          // snake
          ctx.fillStyle = "#22c55e";
          snake.forEach(seg => {
            ctx.fillRect(
              seg.x * cellSize + 2,
              seg.y * cellSize + 2,
              cellSize - 4,
              cellSize - 4
            );
          });

          if (!alive) {
            ctx.fillStyle = "rgba(15,23,42,0.8)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#facc15";
            ctx.font = "14px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("Out of order ‚Äì press R to restart", canvas.width / 2, canvas.height / 2);
          }
        }

        function gameLoop() {
          step();
          draw();
        }

        resetSnake();
        draw();
        setInterval(gameLoop, 150);

        window.addEventListener("keydown", (e) => {
          if (!canvas) return;

          const key = e.key.toLowerCase();

          if (key === "r") {
            resetSnake();
            return;
          }

          let nextDir = null;
          if (key === "w") nextDir = { x: 0, y: -1 };
          if (key === "s") nextDir = { x: 0, y: 1 };
          if (key === "a") nextDir = { x: -1, y: 0 };
          if (key === "d") nextDir = { x: 1, y: 0 };

          if (nextDir) {
            e.preventDefault();
            if (
              snake.length > 1 &&
              snake[0].x + nextDir.x === snake[1].x &&
              snake[0].y + nextDir.y === snake[1].y
            ) {
              return;
            }
            dir = nextDir;
          }
        });
      })();

      /* ---------- RUNNER GAME (with best score & leaderboard) ---------- */
      (function () {
        const canvas = document.getElementById("runnerCanvas");
        const bestScoreEl = document.getElementById("runner-best");
        const leaderboardEl = document.getElementById("runner-leaderboard");
        if (!canvas || !bestScoreEl || !leaderboardEl) return;
        const ctx = canvas.getContext("2d");

        const groundY = canvas.height - 30;
        let player, obstacles, boosts, gaps, speed, gravity, jumpVelocity, score, alive, startTime;

        let bestScore = 0;
        let leaderboard = [];
        const STORAGE_KEY = "mslRunnerLeaderboard";

        function loadLeaderboard() {
          try {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
              const parsed = JSON.parse(stored);
              bestScore = parsed.bestScore || 0;
              leaderboard = parsed.entries || [];
            }
          } catch (e) {}
        }

        function saveBestAndLeaderboard() {
          try {
            localStorage.setItem(
              STORAGE_KEY,
              JSON.stringify({ bestScore, entries: leaderboard })
            );
          } catch (e) {}
        }

        function renderLeaderboard() {
          bestScoreEl.textContent = `Best run on this device: ${Math.floor(bestScore)}s`;
          if (!leaderboard.length) {
            leaderboardEl.textContent =
              "Local leaderboard appears here after a 5-minute run. (Stored only on this device.)";
            return;
          }
          const lines = leaderboard.map((entry, idx) => {
            return `${idx + 1}. ${entry.tag} ‚Äì ${Math.floor(entry.score)}s`;
          });
          leaderboardEl.textContent = "Local leaderboard: " + lines.join(" ¬∑ ");
        }

        loadLeaderboard();
        renderLeaderboard();

        function resetRunner() {
          player = { x: 30, y: groundY, vy: 0, onGround: true };
          obstacles = [];
          boosts = [];
          gaps = [];
          speed = 3;
          gravity = 0.4;
          jumpVelocity = -7.5;
          score = 0;
          alive = true;
          startTime = Date.now();
        }

        function addObstacle() {
          const width = 12 + Math.random() * 10;
          obstacles.push({
            x: canvas.width + 20,
            y: groundY - 15,
            w: width,
            h: 15
          });
        }

        function addBoost() {
          boosts.push({
            x: canvas.width + 60,
            y: groundY - 35,
            size: 10,
            vy: -0.4
          });
        }

        function addGap() {
          const width = 40 + Math.random() * 40;
          gaps.push({
            x: canvas.width + 40,
            w: width
          });
        }

        let frameCount = 0;

        function handleGameOver() {
          const runTime = score; // seconds
          if (runTime > bestScore) {
            bestScore = runTime;
          }

          if (runTime >= 300) {
            // 5 minutes
            let initials = prompt(
              "You survived 5 minutes! Enter a 3-letter tag for the local leaderboard:",
              "MSL"
            );
            if (initials) {
              const tag = initials.toUpperCase().slice(0, 3);
              leaderboard.push({ tag, score: runTime, date: new Date().toISOString() });
              leaderboard.sort((a, b) => b.score - a.score);
              leaderboard = leaderboard.slice(0, 10);
              unlockSecret();
            }
          }

          saveBestAndLeaderboard();
          renderLeaderboard();
        }

        function endRun() {
          if (!alive) return;
          alive = false;
          handleGameOver();
        }

        function updateRunner() {
          if (!alive) return;

          frameCount++;
          const elapsedSec = (Date.now() - startTime) / 1000;
          score = elapsedSec;

          if (frameCount % 120 === 0) addObstacle();
          if (frameCount % 260 === 0) addBoost();
          if (frameCount % 200 === 0) addGap();

          // physics
          player.vy += gravity;
          player.y += player.vy;

          if (player.y >= groundY) {
            player.y = groundY;
            player.vy = 0;
            player.onGround = true;
          }

          // move obstacles
          obstacles.forEach(o => {
            o.x -= speed;
          });
          obstacles = obstacles.filter(o => o.x + o.w > -10);

          // move boosts
          boosts.forEach(b => {
            b.x -= speed * 0.9;
            b.y += b.vy;
          });
          boosts = boosts.filter(b => b.x + b.size > -10);

          // move gaps
          gaps.forEach(g => {
            g.x -= speed;
          });
          gaps = gaps.filter(g => g.x + g.w > -10);

          // obstacle collisions
          for (const o of obstacles) {
            const withinX = player.x + 12 > o.x && player.x - 8 < o.x + o.w;
            const withinY = player.y >= o.y && player.y <= o.y + o.h + 8;
            if (withinX && withinY) {
              endRun();
              return;
            }
          }

          // gap collisions (falling)
          for (const g of gaps) {
            if (player.x > g.x && player.x < g.x + g.w && player.y >= groundY) {
              endRun();
              return;
            }
          }

          // boosts
          boosts.forEach(b => {
            const dx = player.x - (b.x + b.size / 2);
            const dy = player.y - (b.y + b.size / 2);
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 20) {
              speed = 4.5;
              jumpVelocity = -9;
              setTimeout(() => {
                speed = 3;
                jumpVelocity = -7.5;
              }, 5000);
              b.x = -999;
            }
          });
        }

        function drawRunner() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // background
          ctx.fillStyle = "#020617";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // ground line
          ctx.strokeStyle = "#4b5563";
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(0, groundY + 8);
          ctx.lineTo(canvas.width, groundY + 8);
          ctx.stroke();

          // gaps (erase ground under them visually)
          ctx.fillStyle = "#020617";
          gaps.forEach(g => {
            ctx.fillRect(g.x, groundY + 1, g.w, canvas.height - groundY - 1);
          });

          // player
          ctx.fillStyle = "#38bdf8";
          ctx.fillRect(player.x - 8, player.y - 16, 16, 16);

          // obstacles (triangles)
          ctx.fillStyle = "#f97316";
          obstacles.forEach(o => {
            ctx.beginPath();
            ctx.moveTo(o.x, o.y + o.h);
            ctx.lineTo(o.x + o.w / 2, o.y);
            ctx.lineTo(o.x + o.w, o.y + o.h);
            ctx.closePath();
            ctx.fill();
          });

          // boosts (floating blocks)
          ctx.fillStyle = "#facc15";
          boosts.forEach(b => {
            ctx.fillRect(b.x, b.y, b.size, b.size);
          });

          // score
          ctx.fillStyle = "#e5e7eb";
          ctx.font = "12px sans-serif";
          ctx.textAlign = "left";
          ctx.fillText("Score: " + Math.floor(score) + "s", 8, 14);

          if (!alive) {
            ctx.fillStyle = "rgba(15,23,42,0.85)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#f97373";
            ctx.font = "13px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("You tripped on procedure.", canvas.width / 2, canvas.height / 2 - 8);
            ctx.fillStyle = "#facc15";
            ctx.fillText("Press R or tap to try again.", canvas.width / 2, canvas.height / 2 + 10);
          }
        }

        function runnerLoop() {
          updateRunner();
          drawRunner();
          requestAnimationFrame(runnerLoop);
        }

        function jump() {
          if (!alive) {
            resetRunner();
            return;
          }
          if (player.onGround) {
            player.vy = jumpVelocity;
            player.onGround = false;
          }
        }

        canvas.addEventListener("click", jump);
        canvas.addEventListener("touchstart", function (e) {
          e.preventDefault();
          jump();
        });

        window.addEventListener("keydown", (e) => {
          const key = e.key.toLowerCase();
          if (key === " " || key === "spacebar") {
            e.preventDefault();
            jump();
          }
          if (key === "r") {
            resetRunner();
          }
        });

        resetRunner();
        runnerLoop();
      })();

      /* ---------- HANGMAN ---------- */
      (function () {
        const wordEl = document.getElementById("hangman-word");
        const lettersEl = document.getElementById("hangman-letters");
        const statusEl = document.getElementById("hangman-status");
        const resetBtn = document.getElementById("hangman-reset");

        if (!wordEl || !lettersEl || !statusEl || !resetBtn) return;

        const words = [
          "BILL",
          "COMMITTEE",
          "QUORUM",
          "AMENDMENT",
          "CAUCUS",
          "RESOLUTION",
          "CHAMBER",
          "DRAFTING",
          "FLOOR",
          "GAVEL"
        ];

        let secret, revealed, attempts;

        function pickWord() {
          secret = words[Math.floor(Math.random() * words.length)];
          revealed = Array(secret.length).fill("_");
          attempts = 7;
          wordEl.textContent = revealed.join(" ");
          statusEl.textContent = "You have 7 attempts.";
          renderLetters();
        }

        function renderLetters() {
          lettersEl.innerHTML = "";
          const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
          for (const ch of alphabet) {
            const btn = document.createElement("button");
            btn.textContent = ch;
            btn.addEventListener("click", () => guessLetter(ch, btn));
            lettersEl.appendChild(btn);
          }
        }

        function guessLetter(ch, btn) {
          btn.disabled = true;
          let hit = false;
          for (let i = 0; i < secret.length; i++) {
            if (secret[i] === ch) {
              revealed[i] = ch;
              hit = true;
            }
          }
          wordEl.textContent = revealed.join(" ");

          if (!hit) {
            attempts--;
          }

          if (!revealed.includes("_")) {
            statusEl.textContent =
              "You nailed it. Reward: smug confidence next time someone uses that word incorrectly.";
            disableAll();
          } else if (attempts <= 0) {
            statusEl.textContent = `Out of attempts. The word was: ${secret}.`;
            disableAll();
          } else {
            statusEl.textContent = `Attempts left: ${attempts}`;
          }
        }

        function disableAll() {
          const buttons = lettersEl.querySelectorAll("button");
          buttons.forEach(b => (b.disabled = true));
        }

        resetBtn.addEventListener("click", pickWord);
        pickWord();
      })();

      /* ---------- REACTION GAME ---------- */
      (function () {
        const startBtn = document.getElementById("reactionStart");
        const tapBtn = document.getElementById("reactionTap");
        const statusEl = document.getElementById("reactionStatus");
        const resultEl = document.getElementById("reactionResult");
        const bestEl = document.getElementById("reactionBest");
        if (!startBtn || !tapBtn || !statusEl || !resultEl || !bestEl) return;

        let waitingForGo = false;
        let liveRound = false;
        let startTime = 0;
        let timeoutId = null;
        let best = null;

        function labelForReaction(ms) {
          if (ms < 200) return "Elite reflex";
          if (ms < 280) return "Fast";
          if (ms < 360) return "Solid";
          if (ms < 450) return "Warming up";
          return "Keep practicing";
        }

        function scheduleRound() {
          clearTimeout(timeoutId);
          tapBtn.disabled = true;
          liveRound = false;
          waitingForGo = true;
          statusEl.textContent = "Hold steady‚Ä¶ wait for GO.";
          resultEl.textContent = "";
          timeoutId = setTimeout(triggerGo, 1200 + Math.random() * 2200);
        }

        function triggerGo() {
          waitingForGo = false;
          liveRound = true;
          tapBtn.disabled = false;
          tapBtn.focus();
          statusEl.textContent = "GO! Tap now.";
          startTime = performance.now();
        }

        function endRound(message) {
          statusEl.textContent = message;
          tapBtn.disabled = true;
          liveRound = false;
        }

        startBtn.addEventListener("click", () => {
          scheduleRound();
        });

        tapBtn.addEventListener("click", () => {
          if (waitingForGo) {
            endRound("Too soon. Resetting the round.");
            clearTimeout(timeoutId);
            setTimeout(scheduleRound, 600);
            return;
          }

          if (!liveRound) return;
          const reaction = Math.round(performance.now() - startTime);
          resultEl.textContent = `Reaction time: ${reaction} ms (${labelForReaction(reaction)})`;
          if (best === null || reaction < best) {
            best = reaction;
            bestEl.textContent = `Personal best: ${best} ms`;
          }
          endRound("Nice reflexes. Start another round when ready.");
        });

        document.addEventListener("keydown", (event) => {
          if ((event.code === "Space" || event.key === " ") && !tapBtn.disabled) {
            event.preventDefault();
            tapBtn.click();
          }
        });

        bestEl.textContent = "Personal best: ‚Äî";
      })();

      /* ---------- PET PLAYGROUND ---------- */
      (function () {
        const playground = document.getElementById("petPlayground");
        const avatar = document.getElementById("petAvatar");
        const statusEl = document.getElementById("petStatus");
        const petButtons = document.querySelectorAll("[data-pet-select]");
        const treatBtn = document.getElementById("petTreat");
        const centerBtn = document.getElementById("petRoam");
        if (!playground || !avatar || !statusEl) return;

        const petSources = {
          dog: { src: "pet-dog.gif", label: "dog" },
          cat: { src: "pet-cat.gif", label: "cat" },
          koala: { src: "pet-koala.gif", label: "koala" }
        };

        const treatImages = ["secret-bg-alpha.jpg", "secret-bg-beta.jpg"];
        const treatEl = document.createElement("img");
        treatEl.className = "pet-treat";
        playground.appendChild(treatEl);

        const popEl = document.createElement("div");
        popEl.className = "pet-pop";
        popEl.textContent = "+1 treat!";
        playground.appendChild(popEl);

        let currentPet = "dog";
        let position = { x: 50, y: 65 };
        let target = { x: 50, y: 65 };
        let treatPos = { x: 48, y: 62 };
        let treatActive = false;

        function clamp(val) {
          return Math.max(8, Math.min(92, val));
        }

        function updateAvatar(pet) {
          const info = petSources[pet] || petSources.dog;
          avatar.src = info.src;
          avatar.alt = `Animated ${info.label} study buddy`;
          statusEl.textContent = `The ${info.label} is pacing‚Äîguide it with your cursor.`;
        }

        function setTarget(clientX, clientY) {
          const rect = playground.getBoundingClientRect();
          const x = clamp(((clientX - rect.left) / rect.width) * 100);
          const y = clamp(((clientY - rect.top) / rect.height) * 100);
          target.x = x;
          target.y = y;
          return { x, y };
        }

        function randomizeTarget(message) {
          target.x = clamp(Math.random() * 84 + 8);
          target.y = clamp(Math.random() * 70 + 15);
          if (message) statusEl.textContent = message;
        }

        function placeTreat(x, y, message) {
          // Drop a small treat tile and set the buddy's target toward it.
          treatPos = { x: clamp(x, 10, 90), y: clamp(y, 14, 88) };
          treatEl.src = treatImages[Math.floor(Math.random() * treatImages.length)];
          treatEl.style.left = treatPos.x + "%";
          treatEl.style.top = treatPos.y + "%";
          treatEl.classList.add("active");
          treatActive = true;
          target = { ...treatPos };
          if (message) statusEl.textContent = message;
        }

        function celebrateTreat() {
          popEl.classList.remove("show");
          void popEl.offsetWidth;
          popEl.style.left = treatPos.x + "%";
          popEl.style.top = treatPos.y - 4 + "%";
          popEl.classList.add("show");
        }

        function clearTreat(message) {
          treatEl.classList.remove("active");
          treatActive = false;
          if (message) statusEl.textContent = message;
        }

        function checkTreatCollision() {
          if (!treatActive) return;
          const dx = position.x - treatPos.x;
          const dy = position.y - treatPos.y;
          const dist = Math.hypot(dx, dy);
          if (dist < 5) {
            celebrateTreat();
            clearTreat("Treat gobbled! Drop another or guide your buddy around.");
            randomizeTarget("Wandering until the next snack.");
          }
        }

        playground.addEventListener("mousemove", (event) => {
          setTarget(event.clientX, event.clientY);
        });

        playground.addEventListener("click", (event) => {
          const coords = setTarget(event.clientX, event.clientY);
          placeTreat(coords.x, coords.y, "Treat spotted‚Äîyour buddy is sprinting toward it.");
        });

        playground.addEventListener(
          "touchmove",
          (event) => {
            const touch = event.touches[0];
            if (!touch) return;
            event.preventDefault();
            setTarget(touch.clientX, touch.clientY);
          },
          { passive: false }
        );

        playground.addEventListener("touchstart", (event) => {
          const touch = event.touches[0];
          if (!touch) return;
          const coords = setTarget(touch.clientX, touch.clientY);
          placeTreat(coords.x, coords.y, "Snack dropped‚Äîwatch the dash.");
        });

        playground.addEventListener("mouseleave", () => {
          target = { x: 50, y: 75 };
          statusEl.textContent = "Buddy is waiting near the corner.";
        });

        petButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const pet = btn.getAttribute("data-pet-select") || "dog";
            currentPet = pet;
            updateAvatar(pet);
          });
        });

        if (treatBtn) {
          treatBtn.addEventListener("click", () => {
            placeTreat(Math.random() * 78 + 11, Math.random() * 60 + 20, "Treat tossed‚Äîwatch the dash!");
          });
        }

        if (centerBtn) {
          centerBtn.addEventListener("click", () => {
            target = { x: 50, y: 65 };
            clearTreat();
            statusEl.textContent = "Reset and ready for the next prompt.";
          });
        }

        function animate() {
          position.x += (target.x - position.x) * 0.08;
          position.y += (target.y - position.y) * 0.08;
          avatar.style.left = position.x + "%";
          avatar.style.top = position.y + "%";
          avatar.style.filter = `drop-shadow(0 6px 10px rgba(0,0,0,0.45)) hue-rotate(${currentPet === "koala" ? 20 : 0}deg)`;
          avatar.style.transform = `translate(-50%, -50%) scale(${1 + Math.min(0.08, Math.hypot(target.x - position.x, target.y - position.y) / 120)})`;
          checkTreatCollision();
          requestAnimationFrame(animate);
        }

        updateAvatar(currentPet);
        animate();
      })();

      /* ---------- COMPANION (floating dock) ---------- */
      (function () {
        const toggleBtn = document.getElementById("companionToggle");
        const panel = document.getElementById("companionPanel");
        const barEnergy = document.getElementById("barEnergy");
        const barMood = document.getElementById("barMood");
        const barFocus = document.getElementById("barFocus");
        if (!toggleBtn || !panel || !barEnergy || !barMood || !barFocus) return;

        let state = {
          pet: "dog",
          energy: 80,
          mood: 80,
          focus: 60
        };

        const petIcons = {
          dog: "üê∂",
          cat: "üê±",
          koala: "üê®"
        };

        function updateBars() {
          barEnergy.style.width = state.energy + "%";
          barMood.style.width = state.mood + "%";
          barFocus.style.width = state.focus + "%";
        }

        function clamp(val) {
          return Math.max(0, Math.min(100, val));
        }

        // Idle decay
        setInterval(() => {
          state.energy = clamp(state.energy - 0.3);
          state.mood = clamp(state.mood - 0.2);
          state.focus = clamp(state.focus - 0.15);
          updateBars();
        }, 2000);

        updateBars();

        toggleBtn.addEventListener("click", () => {
          panel.classList.toggle("open");
        });

        const actionButtons = panel.querySelectorAll(".companion-actions button");
        actionButtons.forEach(btn => {
          const pet = btn.getAttribute("data-pet");
          const action = btn.getAttribute("data-action");

          if (pet) {
            btn.addEventListener("click", () => {
              state.pet = pet;
              toggleBtn.textContent = petIcons[pet] || "üê∂";
              state.mood = clamp(state.mood + 15);
              state.energy = clamp(state.energy + 5);
              updateBars();
            });
          }

          if (action === "feed") {
            btn.addEventListener("click", () => {
              state.energy = clamp(state.energy + 20);
              state.mood = clamp(state.mood + 5);
              updateBars();
            });
          }
          if (action === "play") {
            btn.addEventListener("click", () => {
              state.mood = clamp(state.mood + 20);
              state.energy = clamp(state.energy - 5);
              updateBars();
            });
          }
          if (action === "study") {
            btn.addEventListener("click", () => {
              state.focus = clamp(state.focus + 20);
              state.energy = clamp(state.energy - 5);
              updateBars();
            });
          }
        });
      })();
    });
  </script>
</body>
</html>
